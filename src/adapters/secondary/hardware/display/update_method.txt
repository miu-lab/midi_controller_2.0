void Ssd1306Display::update() {
    if (!initialized_) {
        Serial.println(F("SSD1306: Update called but display not initialized"));
        return;
    }

    // Vérifier le dirty flag, mais permettre des mises à jour forcées pour des éléments critiques
    if (!isDirty_) {
        // Montrer un petit indicateur d'activité dans le coin inférieur droit
        // même si rien d'autre n'a changé - c'est utile pour débugger l'activité du scheduler
        static uint8_t activityIndicator = 0;
        activityIndicator = (activityIndicator + 1) % 4;
        
        // Dessiner un petit indicateur d'activité dans le coin inférieur droit
        // sans utiliser clear() pour ne pas effacer l'affichage actuel
        switch (activityIndicator) {
            case 0:
                display_.fillRect(124, 60, 4, 4, SSD1306_BLACK);
                display_.drawPixel(125, 61, SSD1306_WHITE);
                break;
            case 1:
                display_.fillRect(124, 60, 4, 4, SSD1306_BLACK);
                display_.drawPixel(126, 61, SSD1306_WHITE);
                break;
            case 2:
                display_.fillRect(124, 60, 4, 4, SSD1306_BLACK);
                display_.drawPixel(126, 62, SSD1306_WHITE);
                break;
            case 3:
                display_.fillRect(124, 60, 4, 4, SSD1306_BLACK);
                display_.drawPixel(125, 62, SSD1306_WHITE);
                break;
        }
        
        // Forcer l'affichage même si rien d'autre n'a changé
        profiler_.startMeasurement();
        display_.display();
        unsigned long duration = profiler_.endMeasurement();
        return;
    }

    // Mesurer le temps d'update
    profiler_.startMeasurement();

    // Envoyer les données du buffer à l'écran physique
    display_.display();
    
    // Réinitialiser le dirty flag
    isDirty_ = false;

    unsigned long duration = profiler_.endMeasurement();

    // Afficher le temps d'update uniquement si nécessaire
    if (duration > 30000) { // Seuil arbitraire de 30ms
        Serial.printf("Display update: %lu µs (slow)\n", duration);
    }
}